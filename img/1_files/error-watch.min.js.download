!function(){"use strict";var r=function(){return(r=Object.assign||function(r){for(var e,t=1,o=arguments.length;t<o;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i]);return r}).apply(this,arguments)},e=function(r){return/SyntaxError|TypeError/g.test(r)},t=function(r){return/(ReferenceError|RangeError|EvalError)/g.test(r)},o={script:"staticJs-P0",link:"staticCss-P0",syntax:"syntaxError-P1",code:"codeError-P1",jsonp:"jsonpError-P1",img:"staticImg-P2",video:"staticVideo-P2",audio:"staticAudio-P2",promise:"promiseError-P2"},i={P0:"1",P1:"2",P2:"3"},n={in:"//in-api.buy.mi.com/log/report/sales.i18n.infra.logreporter.v1.LogReporter/WriteErrorLog",ru:"//ru-api.buy.mi.com/log/report/sales.i18n.infra.logreporter.v1.LogReporter/WriteErrorLog"},s=["mi.com","mi.co.id","po.co","po.co.id","xiaomi.com"],a=d(),l={script:function(r,e){if(!f(e.src))return{type:"",message:""};var t=e.src.indexOf("jsonpcallback")>0;return{type:o[t?"jsonp":r],message:"Static js file loading error;jsUrl="+e.src}},link:function(r,e){return t=e.outerHTML,/rel=\"stylesheet\"/g.test(t)?{type:o[r],message:"Static css file loading error;cssUrl="+e.href}:{type:"",message:""};var t},img:function(r,e){return{type:o[r],message:"Static image file loading error;imgUrl="+e.src}},video:function(r,e){return{type:o[r],message:"Static video file loading error;videoUrl="+e.src}},audio:function(r,e){return{type:o[r],message:"Static audio file loading error;audioUrl="+e.src}}};function c(){return/(iPhone|iPad|iPod|iOS|Android)/i.test(a)?function(r){return!!/ISAPP=(\d{1})/.exec(r)&&!!/ISAPP=(\d{1})/.exec(r)[1]}(document.cookie)?"Android APP "+u():function(r){return!!/ISIOS=(\d{1})/.exec(r)&&!!/ISIOS=(\d{1})/.exec(r)[1]}(document.cookie)?"iOS APP "+u():function(r){return/(Android)/i.test(r)}(a)?"Android Browser":function(r){return/(iPhone|iPad|iPod|iOS)/i.test(r)}(a)?"iOS Browser":"mobile":"pc"}function u(){return r=document.cookie,/APPVERSION=(\d*)/.exec(r)?/APPVERSION=(\d*)/.exec(r)[1]:"";var r}function p(){return window.location.pathname.split("/")[1]}function d(){return navigator.userAgent}function m(){return window.location.href}function f(r){void 0===r&&(r="");for(var e=0;e<s.length;e++)if(r.split("?")[0].indexOf(s[e])>0)return!0;return!1}function E(r){var e=r.length,t={};if(e>0)for(var i=0;i<e;i++){var n=r[i];t[n]=o[n]}return t}function g(r){var i,n=r.target,s=null===(i=null==n?void 0:n.localName)||void 0===i?void 0:i.toLowerCase(),a=r.message,u={};if(s){var E=l[s];if(E){var g=E(s,n),v=g.type,y=g.message,h=v.split("-");u.typ=h[0]||"",u.level=h[1]?Number(h[1][1])+1+"":"",u.message=y}}if(e(a)&&function(r){void 0===r&&(r="");var e=r.indexOf("TypeError")>=0&&r.indexOf("detail")>0,t=r.indexOf("TypeError")>=0&&r.indexOf("dataLayer[0].ecommerce")>0;return!(e||t)}(a)&&f(r.filename)){h=o.syntax.split("-");u.typ=h[0]||"",u.level=h[1]?Number(h[1][1])+1+"":"",u.message=a}if(t(a)&&f(r.filename)){h=o.code.split("-");u.typ=h[0]||"",u.level=h[1]?Number(h[1][1])+1+"":"",u.message=a}return u.url=m(),u.terminal=c(),u.userAgent=d(),u.location=p(),u.stack=r.error?r.error.stack:null,u}function v(){return window.__ERROR__WATCH__IDENTIFIER__}function y(e){var t,o=(t=p(),n[t]||"//sgp-api.buy.mi.com/log/report/sales.i18n.infra.logreporter.v1.LogReporter/WriteErrorLog"),i=new Blob([JSON.stringify({body:[r(r({},e),{version:"FEERRORWATCHV3",timestamp:+new Date})]})],{type:"application/json"});navigator.sendBeacon(o,i)}var h,P=function(){function r(){this.API_KEY="UNKNOWN",this.errorType=Object.assign({},o),this.ERROR_WATCH_IDENTIFIER="UNKNOWN",this.listenerGlobalError=this.listenerGlobalError.bind(this),this.listenerPromiseError=this.listenerPromiseError.bind(this),this.setListenerGlobalError(),this.setListenerPromiseError()}return r.prototype.init=function(r){var e,t,o,i,n=Object.getOwnPropertyNames(this.errorType);(null==r?void 0:r.apikey)&&(this.API_KEY=r.apikey),(null==r?void 0:r.pName)&&(this.ERROR_WATCH_IDENTIFIER=r.pName),(null===(e=null==r?void 0:r.includes)||void 0===e?void 0:e.length)?this.errorType=E((o=n,i=r.includes,o.filter((function(r){return i.includes(r)})))):(null===(t=null==r?void 0:r.excludes)||void 0===t?void 0:t.length)&&(this.errorType=E(function(r,e){return r.filter((function(r){return!e.includes(r)}))}(n,r.excludes))),this.errorType.promise||window.removeEventListener("unhandledrejection",this.listenerPromiseError)},r.prototype.manualReport=function(r){try{var e=r.error,t=r.desc,o=r.level;if(!e)return console.warn("Error parameters cannot be empty");var n=g(e),s="Error-"+(t?t+"-":"")+(o?o.toLocaleUpperCase():n.typ);n.typ=s,n.apikey=this.API_KEY,n.projectName=v()||this.ERROR_WATCH_IDENTIFIER,n.message=t||"",o&&2===o.length?n.level=i[o.toUpperCase()]||null:n.level="3",y(n)}catch(r){console.warn(r)}},r.prototype.listenerPromiseError=function(r){try{y({typ:o.promise.split("-")[0],message:"Promise error reason: "+JSON.stringify(r.reason),apikey:this.API_KEY,projectName:v()||this.ERROR_WATCH_IDENTIFIER,location:p(),level:"3",url:m(),userAgent:d(),terminal:c()})}catch(r){console.warn(r)}},r.prototype.listenerGlobalError=function(r){try{var o=g(r),i=function(r){var o,i=null===(o=r.target.localName)||void 0===o?void 0:o.toLowerCase(),n=r.message;return i||(e(n)?"syntax":t(n)?"code":"")}(r);o.typ&&this.errorType[i]&&(o.apikey=this.API_KEY,o.projectName=v()||this.ERROR_WATCH_IDENTIFIER,y(o))}catch(r){console.warn(r)}},r.prototype.setListenerPromiseError=function(){window.addEventListener("unhandledrejection",this.listenerPromiseError)},r.prototype.setListenerGlobalError=function(){window.addEventListener("error",this.listenerGlobalError,!0)},r}();h=window.MICE&&window.MICE.memo,window.MICE=new P,h&&window.MICE.init(h)}();
